!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/forms"),require("@angular/core"),require("@zxing/library"),require("rxjs")):"function"==typeof define&&define.amd?define("@zxing/ngx-scanner",["exports","@angular/common","@angular/forms","@angular/core","@zxing/library","rxjs"],t):t((e.zxing=e.zxing||{},e.zxing["ngx-scanner"]={}),e.ng.common,e.ng.forms,e.ng.core,e.library,e.rxjs)}(this,function(e,t,n,r,s,o){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function a(t,s,a,c){return new(a=a||Promise)(function(e,n){function r(e){try{o(c.next(e))}catch(t){n(t)}}function i(e){try{o(c["throw"](e))}catch(t){n(t)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,i)}o((c=c.apply(t,s||[])).next())})}function p(r,i){var o,s,a,e,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function n(e){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,s&&(a=2&e[0]?s["return"]:e[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,s=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){c.label=e[1];break}if(6===e[0]&&c.label<a[1]){c.label=a[1],a=e;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(e);break}a[2]&&c.ops.pop(),c.trys.pop();continue}e=i.call(r,c)}catch(t){e=[6,t],s=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return s}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}var h,l=(function g(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(d,h=s.BrowserMultiFormatReader),Object.defineProperty(d.prototype,"isTorchAvailable",{get:function(){return this._isTorchAvailable.asObservable()},enumerable:!0,configurable:!0}),d.prototype.continuousDecodeFromInputVideoDevice=function(e,t){var n=this;if(this.reset(),void 0!==e&&(this.deviceId=e),"undefined"!=typeof navigator){var r=new o.BehaviorSubject({});try{this.getStreamForDevice({deviceId:e}).then(function(e){return n.attachStreamToVideoAndCheckTorch(e,t)}).then(function(e){return n.decodeOnSubject(r,e,n.timeBetweenScansMillis)})}catch(i){r.error(i)}return this._setScanStream(r),r.asObservable()}},d.prototype.getStreamForDevice=function(e){var n=e.deviceId;return a(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return t=this.getUserMediaConstraints(n),[4,navigator.mediaDevices.getUserMedia(t)];case 1:return[2,e.sent()]}})})},d.prototype.getUserMediaConstraints=function(e){return{video:void 0===e?{facingMode:{exact:"environment"}}:{deviceId:{exact:e}}}},d.prototype.setTorch=function(e){if(this._isTorchAvailable.value){var t=this.getVideoTracks(this.stream);e?this.applyTorchOnTracks(t,!0):(this.applyTorchOnTracks(t,!1),this.restart())}},d.prototype.attachStreamToVideoAndCheckTorch=function(e,t){return this.updateTorchCompatibility(e),this.attachStreamToVideo(e,t)},d.prototype.updateTorchCompatibility=function(u){return a(this,void 0,void 0,function(){var t,n,i,o,s,a,c;return p(this,function(e){switch(e.label){case 0:i=this.getVideoTracks(u),e.label=1;case 1:e.trys.push([1,6,7,8]),o=function r(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(i),s=o.next(),e.label=2;case 2:return s.done?[3,5]:(a=s.value,[4,this.isTorchCompatible(a)]);case 3:if(e.sent())return this._isTorchAvailable.next(!0),[3,5];e.label=4;case 4:return s=o.next(),[3,2];case 5:return[3,8];case 6:return c=e.sent(),t={error:c},[3,8];case 7:try{s&&!s.done&&(n=o["return"])&&n.call(o)}finally{if(t)throw t.error}return[7];case 8:return[2]}})})},d.prototype.getVideoTracks=function(e){var t=[];try{t=e.getVideoTracks()}finally{return t||[]}},d.prototype.isTorchCompatible=function(r){return a(this,void 0,void 0,function(){var t,n;return p(this,function(e){switch(e.label){case 0:t=!1,e.label=1;case 1:return e.trys.push([1,,3,4]),[4,new ImageCapture(r).getPhotoCapabilities()];case 2:return n=e.sent(),t=!!n.torch||"fillLightMode"in n&&0!==n.fillLightMode.length,[3,4];case 3:return[2,t];case 4:return[2]}})})},d.prototype.applyTorchOnTracks=function(e,t){e.forEach(function(e){return e.applyConstraints({advanced:[{torch:t,fillLightMode:t?"torch":"none"}]})})},d.prototype._setScanStream=function(e){this._cleanScanStream(),this.scanStream=e},d.prototype._cleanScanStream=function(){this.scanStream&&!this.scanStream.isStopped&&this.scanStream.complete(),this.scanStream=null},d.prototype.decodeOnSubject=function(e,t,n){var r,i=this;if(!e.isStopped)try{r=this.decode(t),e.next({result:r})}catch(o){!o||o instanceof s.NotFoundException||o instanceof s.ChecksumException||o instanceof s.FormatException?e.next({error:o}):e.error(o)}finally{setTimeout(function(){return i.decodeOnSubject(e,t,n)},r?n:0)}},d.prototype.restart=function(){return this.continuousDecodeFromInputVideoDevice(this.deviceId,this.videoElement)},d);function d(){var e=null!==h&&h.apply(this,arguments)||this;return e._isTorchAvailable=new o.BehaviorSubject(undefined),e}var f=(Object.defineProperty(v.prototype,"codeReader",{get:function(){return this._codeReader},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"device",{get:function(){return this._device},set:function(e){if(!e&&null!==e)throw new s.ArgumentException("The `device` must be a valid MediaDeviceInfo or null.");this.isCurrentDevice(e)?console.warn("Setting the same device is not allowed."):this.isAutostarting?console.warn("Avoid setting a device during auto-start."):(this.hasPermission||console.warn("Permissions not set yet, waiting for them to be set to apply device change."),this._reset(),this._device=e,this._enabled&&null!==e&&this.scanFromDevice(e.deviceId))},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"formats",{get:function(){return this.hints.get(s.DecodeHintType.POSSIBLE_FORMATS)},set:function(e){var t=this;if("string"==typeof e)throw new Error("Invalid formats, make sure the [formats] input is a binding.");var n=e.map(function(e){return t.getBarcodeFormatOrFail(e)}),r=this.hints;r.set(s.DecodeHintType.POSSIBLE_FORMATS,n),this.hints=r},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"hints",{get:function(){return this._hints},set:function(e){this._hints=e,this.restart()},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"isAutostarting",{set:function(e){this._isAutostarting=e,this.autostarting.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"isAutstarting",{get:function(){return this._isAutostarting},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"torch",{set:function(e){this.getCodeReader().setTorch(e)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"enable",{set:function(e){this._enabled=Boolean(e),this._enabled?this.device&&this.scanFromDevice(this.device.deviceId):this.reset()},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"tryHarder",{get:function(){return this.hints.get(s.DecodeHintType.TRY_HARDER)},set:function(e){var t=this.hints;e?t.set(s.DecodeHintType.TRY_HARDER,!0):t["delete"](s.DecodeHintType.TRY_HARDER),this.hints=t},enumerable:!0,configurable:!0}),v.prototype.askForPermission=function(){return a(this,void 0,void 0,function(){var t,n,r;return p(this,function(e){switch(e.label){case 0:if(!this.hasNavigator)return console.error("@zxing/ngx-scanner","Can't ask permission, navigator is not present."),this.setPermission(null),[2,this.hasPermission];if(!this.isMediaDevicesSuported)return console.error("@zxing/ngx-scanner","Can't get user media, this is not supported."),this.setPermission(null),[2,this.hasPermission];e.label=1;case 1:return e.trys.push([1,3,4,5]),[4,this.getAnyVideoDevice()];case 2:return t=e.sent(),n=!!t,[3,5];case 3:return r=e.sent(),[2,this.handlePermissionException(r)];case 4:return this.terminateStream(t),[7];case 5:return this.setPermission(n),[2,n]}})})},v.prototype.getAnyVideoDevice=function(){return navigator.mediaDevices.getUserMedia({video:!0})},v.prototype.terminateStream=function(e){e&&e.getTracks().forEach(function(e){return e.stop()}),e=undefined},v.prototype.initAutostartOff=function(){this.isAutostarting=null,this.updateVideoInputDevices()},v.prototype.initAutostartOn=function(){return a(this,void 0,void 0,function(){var t,n,r;return p(this,function(e){switch(e.label){case 0:this.isAutostarting=!0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.askForPermission()];case 2:return t=e.sent(),[3,4];case 3:return n=e.sent(),console.error("Exception occurred while asking for permission:",n),[2];case 4:return t?[4,this.updateVideoInputDevices()]:[3,6];case 5:r=e.sent(),this.autostartScanner(u(r)),e.label=6;case 6:return[2]}})})},v.prototype.isCurrentDevice=function(e){return this.device&&e&&e.deviceId===this.device.deviceId},v.prototype.ngAfterViewInit=function(){var t=this;if(this.getCodeReader().isTorchAvailable.subscribe(function(e){return t.torchCompatible.emit(e)}),!this.autostart)return console.warn("New feature 'autostart' disabled, be careful. Permissions and devices recovery has to be run manually."),void this.initAutostartOff();this.initAutostartOn()},v.prototype.ngOnDestroy=function(){this.reset()},v.prototype.restart=function(){var e=this._reset();e&&(this._codeReader=undefined,this.device=e)},v.prototype.updateVideoInputDevices=function(){return a(this,void 0,void 0,function(){var t,n;return p(this,function(e){switch(e.label){case 0:return[4,this.getCodeReader().listVideoInputDevices()];case 1:return t=e.sent()||[],n=t&&0<t.length,this.hasDevices.next(n),this.camerasFound.next(u(t)),n||this.camerasNotFound.next(),[2,t]}})})},v.prototype.autostartScanner=function(e){var t=e.find(function(e){var t=e.label;return/back|trás|rear|traseira|environment|ambiente/gi.test(t)})||e.pop();if(!t)throw new Error("Impossible to autostart, no input devices available.");this.device=t,this.deviceChange.emit(t),this.isAutostarting=!1,this.autostarted.next()},v.prototype.dispatchScanSuccess=function(e){this.scanSuccess.next(e.getText())},v.prototype.dispatchScanFailure=function(e){this.scanFailure.next(e)},v.prototype.dispatchScanError=function(e){this.scanError.next(e)},v.prototype.dispatchScanComplete=function(e){this.scanComplete.next(e)},v.prototype.handlePermissionException=function(e){var t;switch(console.error("@zxing/ngx-scanner","Error when asking for permission.",e),e.name){case"NotSupportedError":console.warn("@zxing/ngx-scanner",e.message),t=null,this.hasDevices.next(null);break;case"NotAllowedError":console.warn("@zxing/ngx-scanner",e.message),t=!1,this.hasDevices.next(!0);break;case"NotFoundError":console.warn("@zxing/ngx-scanner",e.message),t=null,this.hasDevices.next(!1),this.camerasNotFound.next(e);break;case"NotReadableError":console.warn("@zxing/ngx-scanner","Couldn't read the device(s)'s stream, it's probably in use by another app."),t=null,this.hasDevices.next(!1),this.camerasNotFound.next(e);break;default:console.warn("@zxing/ngx-scanner","I was not able to define if I have permissions for camera or not.",e),t=null}return this.setPermission(t),this.permissionResponse.error(e),t},v.prototype.getBarcodeFormatOrFail=function(e){return"string"==typeof e?s.BarcodeFormat[e.trim().toUpperCase()]:e},v.prototype.getCodeReader=function(){return this._codeReader||(this._codeReader=new l(this.hints)),this._codeReader},v.prototype.scanFromDevice=function(e){var t=this,n=this.previewElemRef.nativeElement,r=this.getCodeReader().continuousDecodeFromInputVideoDevice(e,n);if(!r)throw new Error("Undefined decoding stream, aborting.");r.subscribe(function(e){return t._onDecodeResult(e.result,e.error)},function(e){return t._onDecodeError(e)},function(){t.reset(),console.log("completed")})},v.prototype._onDecodeError=function(e){this.dispatchScanError(e),this.reset()},v.prototype._onDecodeResult=function(e,t){e?this.dispatchScanSuccess(e):this.dispatchScanFailure(t),this.dispatchScanComplete(e)},v.prototype._reset=function(){if(this._codeReader){var e=this.device;return this._device=null,this._codeReader.reset(),e}},v.prototype.reset=function(){this._reset(),this.deviceChange.emit(null)},v.prototype.setPermission=function(e){this.hasPermission=e,this.permissionResponse.next(e)},v.decorators=[{type:r.Component,args:[{selector:"zxing-scanner",template:'<video #preview [style.object-fit]="previewFitMode">\r\n  <p>\r\n    Your browser does not support this feature, please try to upgrade it.\r\n  </p>\r\n  <p>\r\n    Seu navegador não suporta este recurso, por favor tente atualizá-lo.\r\n  </p>\r\n</video>\r\n',changeDetection:r.ChangeDetectionStrategy.OnPush,styles:[":host{display:block}video{width:100%;height:auto;-o-object-fit:contain;object-fit:contain}"]}]}],v.ctorParameters=function(){return[]},v.propDecorators={previewElemRef:[{type:r.ViewChild,args:["preview"]}],autofocusEnabled:[{type:r.Input}],autostarted:[{type:r.Output}],autostarting:[{type:r.Output}],autostart:[{type:r.Input}],previewFitMode:[{type:r.Input}],torchCompatible:[{type:r.Output}],scanSuccess:[{type:r.Output}],scanFailure:[{type:r.Output}],scanError:[{type:r.Output}],scanComplete:[{type:r.Output}],camerasFound:[{type:r.Output}],camerasNotFound:[{type:r.Output}],permissionResponse:[{type:r.Output}],hasDevices:[{type:r.Output}],device:[{type:r.Input}],deviceChange:[{type:r.Output}],formats:[{type:r.Input}],torch:[{type:r.Input}],enable:[{type:r.Input}],tryHarder:[{type:r.Input}]},v);function v(){this.previewFitMode="cover",this.autostarted=new r.EventEmitter,this.autostarting=new r.EventEmitter,this.torchCompatible=new r.EventEmitter,this.scanSuccess=new r.EventEmitter,this.scanFailure=new r.EventEmitter,this.scanError=new r.EventEmitter,this.scanComplete=new r.EventEmitter,this.camerasFound=new r.EventEmitter,this.camerasNotFound=new r.EventEmitter,this.permissionResponse=new r.EventEmitter(!0),this.hasDevices=new r.EventEmitter,this.deviceChange=new r.EventEmitter,this._device=null,this._enabled=!0,this._hints=new Map,this.autofocusEnabled=!0,this.autostart=!0,this.formats=[s.BarcodeFormat.QR_CODE],this.hasNavigator="undefined"!=typeof navigator,this.isMediaDevicesSuported=this.hasNavigator&&!!navigator.mediaDevices}var m=(y.decorators=[{type:r.NgModule,args:[{imports:[t.CommonModule,n.FormsModule],declarations:[f],exports:[f]}]}],y);function y(){}e.ZXingScannerModule=m,e.ZXingScannerComponent=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=zxing-ngx-scanner.umd.min.js.map